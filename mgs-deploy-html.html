<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MGS Foodie Trophy Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Storage API Implementation using localStorage
        window.storage = {
            async get(key) {
                const value = localStorage.getItem(key);
                return value ? { key, value, shared: false } : null;
            },
            async set(key, value) {
                localStorage.setItem(key, value);
                return { key, value, shared: false };
            },
            async delete(key) {
                localStorage.removeItem(key);
                return { key, deleted: true, shared: false };
            },
            async list(prefix) {
                const keys = Object.keys(localStorage).filter(k => !prefix || k.startsWith(prefix));
                return { keys, prefix, shared: false };
            }
        };

        // Lucide Icons (simplified inline versions)
        const Check = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const User = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const LogOut = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const MGSFoodTracker = () => {
            const [user, setUser] = useState(null);
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [isLogin, setIsLogin] = useState(true);
            const [checkedItems, setCheckedItems] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const foodCategories = {
                'Raw Food': ['Gerbil', 'Afghan Pika', 'Long-eared Hedgehog', 'Four-toed Hedgehog', 'Common Raven', 'Trumpeter Hornbill', 'Black Stork', 'Oriental Stork', 'Jehuty', 'Anubis', 'Gray Wolf', 'Side-striped Jackal', 'African Wild Dog', 'Brown Bear', 'Himalayan Brown Bear', 'Cashmere Goat', 'Karakul Sheep', 'Nubian', 'Boer Goat', 'Okapi', "Grant's Zebra", 'Wild Ass', 'Martial Eagle', 'Griffon Vulture', 'Lappet-faced Vulture', 'Wildberry', 'Milk', 'Black Carrot', 'Ration', 'Corn', 'Onion', 'Potato', 'Tomato'],
                'Grilled Food': ['Roasted Gerbil', 'Roasted Afghan Pika', 'Roasted Long-eared Hedgehog', 'Roasted Four-toed Hedgehog', 'Grilled Common Raven', 'Grilled Trumpeter Hornbill', 'Grilled Black Stork', 'Grilled Oriental Stork', 'Grilled Jehuty', 'Grilled Anubis', 'Grilled Gray Wolf', 'Grilled Side-striped Jackal', 'Grilled African Wild Dog', 'Grilled Brown Bear', 'Grilled Himalayan Brown Bear', 'Grilled Cashmere Goat', 'Grilled Karakul Sheep', 'Grilled Nubian', 'Grilled Boer Goat', 'Grilled Okapi', "Grilled Grant's Zebra", 'Grilled Wild Ass', 'Grilled Martial Eagle', 'Grilled Griffon Vulture', 'Grilled Lappet-faced Vulture'],
                'Stews': ['Gerbil Milk Stew', 'Afghan Pika Milk Stew', 'Common Raven Tomato Stew', 'Trumpeter Hornbill Tomato Stew', 'Anubis Soup', 'Gray Wolf Soup', 'Side-striped Jackal Soup', 'African Wild Dog Soup', 'Brown Bear Soup', 'Himalayan Brown Bear Soup', 'Cashmere Goat Soup', 'Karakul Sheep Soup', 'Nubian Soup', 'Boer Goat Soup', 'Okapi Soup', "Grant's Zebra Soup", 'Wild Ass Soup', 'Canteen (Clear Water)', 'Bottle (Clear Water)'],
                'Smoked Food': ['Smoked Gerbil', 'Smoked Afghan Pika', 'Smoked Long-eared Hedgehog', 'Smoked Four-toed Hedgehog', 'Smoked Common Raven', 'Smoked Trumpeter Hornbill', 'Smoked Black Stork', 'Smoked Oriental Stork', 'Smoked Jehuty', 'Smoked Anubis', 'Smoked Gray Wolf', 'Smoked Side-striped Jackal', 'Smoked African Wild Dog', 'Smoked Brown Bear', 'Smoked Himalayan Brown Bear', 'Smoked Cashmere Goat', 'Smoked Karakul Sheep', 'Smoked Nubian', 'Smoked Boer Goat', 'Smoked Okapi', "Smoked Grant's Zebra", 'Smoked Wild Ass', 'Smoked Martial Eagle', 'Smoked Griffon Vulture', 'Smoked Lappet-faced Vulture'],
                'Baked Food': ['Gerbil Meat Pie', 'Hedgehog Meat Pie', 'Hedgehog Tacos', 'Common Raven Meat Pie', 'Trumpeter Hornbill Meat Pie', 'Black Stork Pizza', 'Oriental Stork Pizza', 'Jehuty Pizza', 'Cashmere Goat Pizza', 'Karakul Sheep Meat Pie', 'Nubian Pizza', 'Okapi Pizza', "Grant's Zebra Pizza", 'Wild Ass Meat Pie', 'Martial Eagle Pizza', 'Lappet-faced Vulture Pizza', 'Boer Goat Meat Pie', 'Afghan Pika Meat Pie', 'Griffon Vulture Meat Pie', 'Baked Potato', 'Mashed Potatoes', 'Roasted Onions', 'Grilled Corn', 'Black Stork Heart Tacos', 'Oriental Stork Heart Spit Roast'],
                'Steamed Food': ['Steamed Gerbil', 'Steamed Afghan Pika', 'Steamed Long-eared Hedgehog', 'Steamed Four-toed Hedgehog', 'Steamed Common Raven', 'Steamed Trumpeter Hornbill', 'Steamed Black Stork', 'Steamed Oriental Stork', 'Steamed Jehuty', 'Steamed Anubis', 'Steamed Gray Wolf', 'Steamed Side-striped Jackal', 'Steamed African Wild Dog', 'Steamed Brown Bear', 'Steamed Himalayan Brown Bear', 'Steamed Cashmere Goat', 'Steamed Karakul Sheep', 'Steamed Nubian', 'Steamed Boer Goat', 'Steamed Okapi', "Steamed Grant's Zebra", 'Steamed Wild Ass', 'Steamed Martial Eagle', 'Steamed Griffon Vulture', 'Steamed Lappet-faced Vulture'],
                'Special Food': ['Bear Paw Stew', 'Karakul Sheep Liver Stew', 'Nubian Liver Stew', 'Okapi Tongue Stew', 'Zebra Tail Soup']
            };

            const totalItems = Object.values(foodCategories).flat().length;

            useEffect(() => {
                loadUser();
            }, []);

            useEffect(() => {
                if (user) {
                    loadProgress();
                }
            }, [user]);

            const loadUser = async () => {
                try {
                    const userData = await window.storage.get('mgs_current_user');
                    if (userData) {
                        setUser(JSON.parse(userData.value));
                    }
                } catch (err) {
                    // No user logged in
                }
            };

            const loadProgress = async () => {
                if (!user) return;
                try {
                    const progress = await window.storage.get(`mgs_progress_${user.username}`);
                    if (progress) {
                        setCheckedItems(JSON.parse(progress.value));
                    }
                } catch (err) {
                    // No progress found, start fresh
                }
            };

            const saveProgress = async (newChecked) => {
                if (!user) return;
                try {
                    await window.storage.set(`mgs_progress_${user.username}`, JSON.stringify(newChecked));
                } catch (err) {
                    setError('Failed to save progress');
                }
            };

            const handleAuth = async () => {
                if (!username || !password) {
                    setError('Please enter username and password');
                    return;
                }

                setError('');
                setLoading(true);

                try {
                    if (isLogin) {
                        // Login logic
                        let userData = null;
                        try {
                            userData = await window.storage.get(`mgs_user_${username}`);
                        } catch (err) {
                            // User doesn't exist
                        }

                        if (!userData) {
                            setError('User not found');
                            setLoading(false);
                            return;
                        }

                        const storedUser = JSON.parse(userData.value);
                        if (storedUser.password === password) {
                            setUser(storedUser);
                            await window.storage.set('mgs_current_user', JSON.stringify(storedUser));
                            setUsername('');
                            setPassword('');
                        } else {
                            setError('Incorrect password');
                            setLoading(false);
                            return;
                        }
                    } else {
                        // Sign up logic
                        let existingUser = null;
                        try {
                            existingUser = await window.storage.get(`mgs_user_${username}`);
                        } catch (err) {
                            // User doesn't exist, which is what we want
                        }

                        if (existingUser) {
                            setError('Username already exists');
                            setLoading(false);
                            return;
                        }

                        const newUser = { username, password };
                        await window.storage.set(`mgs_user_${username}`, JSON.stringify(newUser));
                        setUser(newUser);
                        await window.storage.set('mgs_current_user', JSON.stringify(newUser));
                        setUsername('');
                        setPassword('');
                    }
                } catch (err) {
                    console.error('Auth error:', err);
                    setError(`Authentication failed: ${err.message || 'Unknown error'}`);
                }
                
                setLoading(false);
            };

            const handleLogout = async () => {
                try {
                    await window.storage.delete('mgs_current_user');
                    setUser(null);
                    setCheckedItems({});
                    setUsername('');
                    setPassword('');
                } catch (err) {
                    setError('Logout failed');
                }
            };

            const handleCheck = (item) => {
                const newChecked = { ...checkedItems, [item]: !checkedItems[item] };
                setCheckedItems(newChecked);
                saveProgress(newChecked);
            };

            const handleReset = async () => {
                if (window.confirm('Are you sure you want to reset all progress?')) {
                    setCheckedItems({});
                    if (user) {
                        try {
                            await window.storage.delete(`mgs_progress_${user.username}`);
                        } catch (err) {
                            setError('Reset failed');
                        }
                    }
                }
            };

            const checkedCount = Object.values(checkedItems).filter(Boolean).length;
            const progress = Math.round((checkedCount / totalItems) * 100);

            if (!user) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center p-4">
                        <div className="bg-gray-800 rounded-lg shadow-2xl p-8 w-full max-w-md border border-gray-700">
                            <div className="text-center mb-6">
                                <h1 className="text-3xl font-bold text-green-400 mb-2">MGS Foodie Tracker</h1>
                                <p className="text-gray-400">Track your trophy progress</p>
                            </div>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-gray-300 mb-2">Username</label>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAuth()}
                                        className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:border-green-400 focus:outline-none"
                                        placeholder="Enter username"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-gray-300 mb-2">Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAuth()}
                                        className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:border-green-400 focus:outline-none"
                                        placeholder="Enter password"
                                    />
                                </div>

                                {error && <p className="text-red-400 text-sm">{error}</p>}
                                
                                <button
                                    onClick={handleAuth}
                                    disabled={loading}
                                    className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded transition disabled:opacity-50"
                                >
                                    {loading ? 'Processing...' : isLogin ? 'Login' : 'Sign Up'}
                                </button>
                                
                                <button
                                    onClick={() => {
                                        setIsLogin(!isLogin);
                                        setError('');
                                    }}
                                    className="w-full text-green-400 hover:text-green-300 text-sm transition"
                                >
                                    {isLogin ? 'Need an account? Sign up' : 'Have an account? Login'}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-gray-800 rounded-lg shadow-2xl border border-gray-700 mb-6 p-6">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-green-400 mb-2">Metal Gear Survive - Foodie Trophy</h1>
                                    <div className="flex items-center gap-2 text-gray-300">
                                        <User size={16} />
                                        <span>{user.username}</span>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={handleReset}
                                        className="flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition"
                                    >
                                        <Trash2 size={16} />
                                        Reset
                                    </button>
                                    <button
                                        onClick={handleLogout}
                                        className="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition"
                                    >
                                        <LogOut size={16} />
                                        Logout
                                    </button>
                                </div>
                            </div>
                            
                            <div className="mt-6">
                                <div className="flex justify-between text-sm text-gray-300 mb-2">
                                    <span>Progress: {checkedCount} / {totalItems}</span>
                                    <span>{progress}%</span>
                                </div>
                                <div className="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                                    <div
                                        className="bg-green-500 h-full transition-all duration-300"
                                        style={{ width: `${progress}%` }}
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="grid gap-6">
                            {Object.entries(foodCategories).map(([category, items]) => {
                                const categoryChecked = items.filter(item => checkedItems[item]).length;
                                return (
                                    <div key={category} className="bg-gray-800 rounded-lg shadow-xl border border-gray-700 p-6">
                                        <h2 className="text-xl font-bold text-green-400 mb-4 flex justify-between">
                                            <span>{category}</span>
                                            <span className="text-gray-400 text-sm">
                                                {categoryChecked} / {items.length}
                                            </span>
                                        </h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            {items.map((item) => (
                                                <label
                                                    key={item}
                                                    className={`flex items-center gap-3 p-3 rounded cursor-pointer transition ${
                                                        checkedItems[item]
                                                            ? 'bg-green-900 bg-opacity-30 border border-green-600'
                                                            : 'bg-gray-700 hover:bg-gray-600 border border-gray-600'
                                                    }`}
                                                >
                                                    <input
                                                        type="checkbox"
                                                        checked={checkedItems[item] || false}
                                                        onChange={() => handleCheck(item)}
                                                        className="hidden"
                                                    />
                                                    <div className={`flex-shrink-0 w-5 h-5 rounded border-2 flex items-center justify-center ${
                                                        checkedItems[item]
                                                            ? 'bg-green-600 border-green-600'
                                                            : 'border-gray-500'
                                                    }`}>
                                                        {checkedItems[item] && <Check size={16} className="text-white" />}
                                                    </div>
                                                    <span className={`text-sm ${checkedItems[item] ? 'text-green-300 line-through' : 'text-gray-200'}`}>
                                                        {item}
                                                    </span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        <div className="mt-6 text-center text-gray-500 text-sm">
                            <p>Note: Spoiled food does not count toward the trophy</p>
                            <p className="mt-2">Total: {totalItems} food items â€¢ Original site by <a target="_blank" href="https://github.com/Ak-0/MGSurvive-TrophyHelper">Ak-0</a></p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MGSFoodTracker />, document.getElementById('root'));
    </script>
</body>
</html>
